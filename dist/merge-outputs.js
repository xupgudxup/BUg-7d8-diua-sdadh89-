'use strict';const a6_0xc10eb4=a6_0x2591;function a6_0x3e99(){const _0x288034=['3177QSqJXj','Merge\x20complete\x20in\x20','ARTIFACTS_DIR','__importStar','split','writeFileSync','push','toFixed','existsSync','default','toISOString','../output','now','create','filter','getTime','from','description','utf-8','Error\x20reading\x20','error','created_at','\x20new\x20posts.\x20Total:\x20','addPost','readFileSync','index.json','length','Starting\x20merge\x20of\x20batch\x20outputs...','classify','Starting\x20Classification\x20&\x20Aggregation...','No\x20artifacts\x20directory\x20found.','3uMiLoT','stringify','writable','Classifier','title','1331fMWjig','mkdirSync','log','Loaded\x20','has','defineProperty','2968696WQpHgZ','output-','./classifier','__esModule','fullText','getOwnPropertyNames','Found\x20','472210lVzbUb','init','BucketManager','175020FucjMJ','7248330dEgXGX','1103415NNniBL','path','../artifacts','Merged\x20','./bucket-manager','substring','6248564YlJJKj','get','Could\x20not\x20read\x20index,\x20starting\x20fresh.','startsWith','5XMhDTv','__createBinding','parse','\x20batch\x20artifacts.','error-log.json','add','join','link','13560XQBMbe'];a6_0x3e99=function(){return _0x288034;};return a6_0x3e99();}(function(_0x4fc385,_0x2b2a1d){const _0x34a103=a6_0x2591,_0x170a1a=_0x4fc385();while(!![]){try{const _0x55c084=-parseInt(_0x34a103(0x105))/0x1+-parseInt(_0x34a103(0x100))/0x2+parseInt(_0x34a103(0xee))/0x3*(parseInt(_0x34a103(0xf9))/0x4)+-parseInt(_0x34a103(0x10f))/0x5*(parseInt(_0x34a103(0x104))/0x6)+parseInt(_0x34a103(0x10b))/0x7+parseInt(_0x34a103(0x117))/0x8*(-parseInt(_0x34a103(0x118))/0x9)+parseInt(_0x34a103(0x103))/0xa*(parseInt(_0x34a103(0xf3))/0xb);if(_0x55c084===_0x2b2a1d)break;else _0x170a1a['push'](_0x170a1a['shift']());}catch(_0x4a86fb){_0x170a1a['push'](_0x170a1a['shift']());}}}(a6_0x3e99,0x941c2));var __createBinding=this&&this[a6_0xc10eb4(0x110)]||(Object[a6_0xc10eb4(0x125)]?function(_0x1c3745,_0xa3432b,_0x525306,_0xa95f40){const _0x41d562=a6_0xc10eb4;if(_0xa95f40===undefined)_0xa95f40=_0x525306;var _0x20d6d4=Object['getOwnPropertyDescriptor'](_0xa3432b,_0x525306);(!_0x20d6d4||(_0x41d562(0x10c)in _0x20d6d4?!_0xa3432b[_0x41d562(0xfc)]:_0x20d6d4[_0x41d562(0xf0)]||_0x20d6d4['configurable']))&&(_0x20d6d4={'enumerable':!![],'get':function(){return _0xa3432b[_0x525306];}}),Object[_0x41d562(0xf8)](_0x1c3745,_0xa95f40,_0x20d6d4);}:function(_0x254b7b,_0xf962f1,_0x11bd95,_0x4e11e4){if(_0x4e11e4===undefined)_0x4e11e4=_0x11bd95;_0x254b7b[_0x4e11e4]=_0xf962f1[_0x11bd95];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x46b5f6,_0x5da78c){const _0x146451=a6_0xc10eb4;Object[_0x146451(0xf8)](_0x46b5f6,_0x146451(0x121),{'enumerable':!![],'value':_0x5da78c});}:function(_0xdac243,_0x37d6f0){const _0x41df45=a6_0xc10eb4;_0xdac243[_0x41df45(0x121)]=_0x37d6f0;}),__importStar=this&&this[a6_0xc10eb4(0x11b)]||(function(){var _0x293ffe=function(_0x15d027){const _0xa29f49=a6_0x2591;return _0x293ffe=Object[_0xa29f49(0xfe)]||function(_0x538ff1){const _0x5b42cb=_0xa29f49;var _0x3c0966=[];for(var _0x98b67c in _0x538ff1)if(Object['prototype']['hasOwnProperty']['call'](_0x538ff1,_0x98b67c))_0x3c0966[_0x3c0966[_0x5b42cb(0xe9)]]=_0x98b67c;return _0x3c0966;},_0x293ffe(_0x15d027);};return function(_0x1bc8e4){const _0x226a7c=a6_0x2591;if(_0x1bc8e4&&_0x1bc8e4['__esModule'])return _0x1bc8e4;var _0x2d91cf={};if(_0x1bc8e4!=null){for(var _0x5873e5=_0x293ffe(_0x1bc8e4),_0xc2fbfe=0x0;_0xc2fbfe<_0x5873e5[_0x226a7c(0xe9)];_0xc2fbfe++)if(_0x5873e5[_0xc2fbfe]!==_0x226a7c(0x121))__createBinding(_0x2d91cf,_0x1bc8e4,_0x5873e5[_0xc2fbfe]);}return __setModuleDefault(_0x2d91cf,_0x1bc8e4),_0x2d91cf;};}());Object[a6_0xc10eb4(0xf8)](exports,a6_0xc10eb4(0xfc),{'value':!![]});const fs=__importStar(require('fs')),path=__importStar(require(a6_0xc10eb4(0x106))),classifier_1=require(a6_0xc10eb4(0xfb)),bucket_manager_1=require(a6_0xc10eb4(0x109)),ARTIFACTS_DIR=process['env'][a6_0xc10eb4(0x11a)]||path[a6_0xc10eb4(0x115)](__dirname,a6_0xc10eb4(0x107)),OUTPUT_DIR=path['join'](__dirname,a6_0xc10eb4(0x123)),INDEX_FILE=path['join'](OUTPUT_DIR,a6_0xc10eb4(0xe8));function a6_0x2591(_0x5a106f,_0x1a5172){const _0x3e99ca=a6_0x3e99();return a6_0x2591=function(_0x2591e2,_0x393a40){_0x2591e2=_0x2591e2-0xe4;let _0xddc44=_0x3e99ca[_0x2591e2];return _0xddc44;},a6_0x2591(_0x5a106f,_0x1a5172);}async function mergeOutputs(){const _0x227a98=a6_0xc10eb4,_0x1b1a69=Date[_0x227a98(0x124)]();console[_0x227a98(0xf5)](_0x227a98(0xea));!fs[_0x227a98(0x120)](OUTPUT_DIR)&&fs[_0x227a98(0xf4)](OUTPUT_DIR,{'recursive':!![]});let _0x5e01ba=[];if(fs[_0x227a98(0x120)](INDEX_FILE))try{_0x5e01ba=JSON[_0x227a98(0x111)](fs[_0x227a98(0xe7)](INDEX_FILE,_0x227a98(0x12a)));}catch{console[_0x227a98(0xf5)](_0x227a98(0x10d));}const _0x1f72ab=new Set(_0x5e01ba),_0x2c7fe7=new Set(),_0x59a645=new Date()[_0x227a98(0x122)]()[_0x227a98(0x11c)]('T')[0x0],_0x58d8ed=path[_0x227a98(0x115)](OUTPUT_DIR,_0x59a645+'.json');let _0x1a02df=[];if(fs[_0x227a98(0x120)](_0x58d8ed))try{_0x1a02df=JSON[_0x227a98(0x111)](fs['readFileSync'](_0x58d8ed,'utf-8'));for(const _0x34b831 of _0x1a02df){_0x34b831[_0x227a98(0xfd)]&&_0x2c7fe7[_0x227a98(0x114)](_0x34b831[_0x227a98(0xfd)][_0x227a98(0x10a)](0x0,0x64));}console[_0x227a98(0xf5)](_0x227a98(0xf6)+_0x1a02df[_0x227a98(0xe9)]+'\x20existing\x20posts\x20from\x20today.');}catch{console[_0x227a98(0xf5)]('Could\x20not\x20read\x20daily\x20file,\x20starting\x20fresh.');}if(!fs[_0x227a98(0x120)](ARTIFACTS_DIR)){console['log'](_0x227a98(0xed));return;}const _0x4ae317=fs['readdirSync'](ARTIFACTS_DIR)[_0x227a98(0x126)](_0x181986=>_0x181986[_0x227a98(0x10e)](_0x227a98(0xfa)))['map'](_0x31c0e0=>path[_0x227a98(0x115)](ARTIFACTS_DIR,_0x31c0e0));console[_0x227a98(0xf5)](_0x227a98(0xff)+_0x4ae317[_0x227a98(0xe9)]+_0x227a98(0x112));let _0x430f7f=0x0;for(const _0x3585ac of _0x4ae317){const _0x6dd112=fs['readdirSync'](_0x3585ac)[_0x227a98(0x126)](_0xa720af=>_0xa720af['match'](/^\d{4}-\d{2}-\d{2}\.json$/));for(const _0x335f44 of _0x6dd112){try{const _0x1858b1=fs[_0x227a98(0xe7)](path[_0x227a98(0x115)](_0x3585ac,_0x335f44),_0x227a98(0x12a)),_0x33052b=JSON[_0x227a98(0x111)](_0x1858b1);for(const _0x27a7c1 of _0x33052b){if(_0x1f72ab[_0x227a98(0xf7)](_0x27a7c1['link']))continue;if(_0x27a7c1[_0x227a98(0xfd)]){const _0x258b15=_0x27a7c1[_0x227a98(0xfd)]['substring'](0x0,0x64);if(_0x2c7fe7['has'](_0x258b15))continue;_0x2c7fe7[_0x227a98(0x114)](_0x258b15);}_0x1a02df[_0x227a98(0x11e)](_0x27a7c1),_0x1f72ab['add'](_0x27a7c1[_0x227a98(0x116)]),_0x430f7f++;}}catch(_0x3ab6ab){console[_0x227a98(0x12c)](_0x227a98(0x12b)+_0x335f44+':',_0x3ab6ab);}}const _0x43942b=path[_0x227a98(0x115)](_0x3585ac,_0x227a98(0x113));if(fs[_0x227a98(0x120)](_0x43942b)){const _0x16e83e=path[_0x227a98(0x115)](OUTPUT_DIR,_0x227a98(0x113));let _0x581a76=[];if(fs[_0x227a98(0x120)](_0x16e83e))try{_0x581a76=JSON[_0x227a98(0x111)](fs[_0x227a98(0xe7)](_0x16e83e,'utf-8'));}catch{}try{const _0x109b0f=JSON[_0x227a98(0x111)](fs['readFileSync'](_0x43942b,_0x227a98(0x12a)));_0x581a76[_0x227a98(0x11e)](..._0x109b0f);}catch{}fs[_0x227a98(0x11d)](_0x16e83e,JSON[_0x227a98(0xef)](_0x581a76,null,0x2),_0x227a98(0x12a));}}console[_0x227a98(0xf5)](_0x227a98(0x108)+_0x430f7f+_0x227a98(0xe5)+_0x1a02df[_0x227a98(0xe9)]),_0x1a02df['sort']((_0x4bcea1,_0x4b93d0)=>new Date(_0x4b93d0['created_at'])[_0x227a98(0x127)]()-new Date(_0x4bcea1[_0x227a98(0xe4)])[_0x227a98(0x127)]()),fs[_0x227a98(0x11d)](_0x58d8ed,JSON['stringify'](_0x1a02df,null,0x2),_0x227a98(0x12a)),fs['writeFileSync'](INDEX_FILE,JSON['stringify'](Array[_0x227a98(0x128)](_0x1f72ab),null,0x2),'utf-8'),console[_0x227a98(0xf5)](_0x227a98(0xec));const _0x9f3310=new classifier_1[(_0x227a98(0xf1))](),_0x57b13e=new bucket_manager_1[(_0x227a98(0x102))](OUTPUT_DIR);await _0x57b13e[_0x227a98(0x101)]();let _0x547146=0x0;for(const _0x3ac425 of _0x1a02df){const _0x2b2f15=_0x9f3310[_0x227a98(0xeb)](_0x3ac425[_0x227a98(0xf2)],_0x3ac425[_0x227a98(0x129)]);if(_0x2b2f15[_0x227a98(0xe9)]>0x0){for(const _0x13536c of _0x2b2f15){_0x57b13e[_0x227a98(0xe6)](_0x3ac425,_0x13536c);}_0x547146++;}}await _0x57b13e['flush']();const _0x64867f=Date[_0x227a98(0x124)]();console[_0x227a98(0xf5)](_0x227a98(0x119)+((_0x64867f-_0x1b1a69)/0x3e8)[_0x227a98(0x11f)](0x2)+'s.'),console[_0x227a98(0xf5)]('Total\x20posts:\x20'+_0x1a02df[_0x227a98(0xe9)]+'\x20|\x20Classified:\x20'+_0x547146);}mergeOutputs()['catch'](console['error']);